<div class="container">
  <h1>Premium Calculator</h1>

  <form [formGroup]="premiumForm" class="premium-form">
    <div class="form-group">
      <label for="name">Name *</label>
      <input
        id="name"
        type="text"
        formControlName="name"
        class="form-control"
        [class.invalid]="isFieldInvalid('name')"
        placeholder="Enter your name">
      <div *ngIf="isFieldInvalid('name')" class="error">
        <span *ngIf="getFieldError('name', 'required')">Name is required</span>
        <span *ngIf="getFieldError('name', 'minlength')">Name must be at least 2 characters</span>
        <span *ngIf="getFieldError('name', 'maxlength')">Name cannot exceed 100 characters</span>
      </div>
    </div>

    <div class="form-group">
      <label for="ageNextBirthday">Age Next Birthday *</label>
      <input
        id="ageNextBirthday"
        type="number"
        formControlName="ageNextBirthday"
        class="form-control"
        [class.invalid]="isFieldInvalid('ageNextBirthday')"
        placeholder="Enter age next birthday">
      <div *ngIf="isFieldInvalid('ageNextBirthday')" class="error">
        <span *ngIf="getFieldError('ageNextBirthday', 'required')">Age is required</span>
        <span *ngIf="getFieldError('ageNextBirthday', 'tooYoung')">Age must be at least 1</span>
        <span *ngIf="getFieldError('ageNextBirthday', 'tooOld')">Age cannot exceed 100</span>
      </div>
    </div>

    <div class="form-group">
      <label for="dateOfBirth">Date of Birth (MM/YYYY) *</label>
      <input
        id="dateOfBirth"
        type="text"
        formControlName="dateOfBirth"
        class="form-control"
        [class.invalid]="isFieldInvalid('dateOfBirth')"
        placeholder="MM/YYYY"
        maxlength="7">
      <div *ngIf="isFieldInvalid('dateOfBirth')" class="error">
        <span *ngIf="getFieldError('dateOfBirth', 'required')">Date of Birth is required</span>
        <span *ngIf="getFieldError('dateOfBirth', 'invalidDateFormat')">Please use MM/YYYY format</span>
        <span *ngIf="getFieldError('dateOfBirth', 'invalidMonth')">Invalid month</span>
        <span *ngIf="getFieldError('dateOfBirth', 'invalidYear')">Year must be between {{premiumForm.get('dateOfBirth')?.errors?.['invalidYear']?.min}} and {{premiumForm.get('dateOfBirth')?.errors?.['invalidYear']?.max}}</span>
      </div>
    </div>

    <div class="form-group">
      <label for="occupation">Usual Occupation *</label>
      <select
        id="occupation"
        formControlName="occupation"
        class="form-control"
        [class.invalid]="isFieldInvalid('occupation')">
        <option value="">Select Occupation</option>
        <option *ngFor="let occ of occupations" [value]="occ.value">
          {{occ.name}}
        </option>
      </select>
      <div *ngIf="isFieldInvalid('occupation')" class="error">
        Occupation is required
      </div>
      <div *ngIf="selectedOccupationDetails" class="occupation-details">
        <small>Rating: <span class="highlight">{{getOccupationRating()}}</span> | Factor: <span class="highlight">{{getOccupationFactor()}}</span></small>
      </div>
    </div>

    <div class="form-group">
      <label for="deathSumInsured">Death - Sum Insured ($) *</label>
      <input
        id="deathSumInsured"
        type="number"
        formControlName="deathSumInsured"
        class="form-control"
        [class.invalid]="isFieldInvalid('deathSumInsured')"
        placeholder="Enter sum insured amount"
        min="1"
        max="10000000">
      <div *ngIf="isFieldInvalid('deathSumInsured')" class="error">
        <span *ngIf="getFieldError('deathSumInsured', 'required')">Sum Insured is required</span>
        <span *ngIf="getFieldError('deathSumInsured', 'invalidAmount')">Amount must be greater than 0</span>
        <span *ngIf="getFieldError('deathSumInsured', 'amountTooHigh')">Amount cannot exceed $10,000,000</span>
      </div>
    </div>

    <div class="premium-display" [class.updated]="premiumUpdated" *ngIf="calculationResult && monthlyPremium > 0">
      <h2>Monthly Premium</h2>
      <p class="premium-amount" [class.updated]="premiumUpdated">{{formatCurrency(monthlyPremium)}}</p>

      <div class="premium-summary">
        <p><strong>Annual Premium:</strong> {{formatCurrency(calculationResult.annualPremium)}}</p>
        <p><strong>Occupation Rating:</strong> {{calculationResult.occupationRating}}</p>
        <p><strong>Rating Factor:</strong> {{calculationResult.occupationFactor}}</p>
      </div>

      <button
        type="button"
        class="details-toggle"
        (click)="toggleCalculationDetails()">
        {{showCalculationDetails ? 'Hide' : 'Show'}} Calculation Details
      </button>

      <div class="calculation-details" *ngIf="showCalculationDetails">
        <h3>Calculation Breakdown</h3>
        <div class="formula">
          <p><strong>Formula:</strong> (Death Cover × Rating Factor × Age) ÷ 1000 × 12</p>
          <p><strong>Details:</strong> {{calculationResult.calculationDetails.formula}}</p>
        </div>
        <div class="breakdown">
          <ul>
            <li><strong>Death Cover Amount:</strong> {{formatCurrency(calculationResult.calculationDetails.deathCoverAmount)}}</li>
            <li><strong>Age Next Birthday:</strong> {{calculationResult.calculationDetails.age}} years</li>
            <li><strong>Occupation Factor:</strong> {{calculationResult.calculationDetails.factor}}</li>
            <li><strong>Monthly Premium:</strong> {{formatCurrency(calculationResult.annualPremium)}} ÷ 12 = {{formatCurrency(monthlyPremium)}}</li>
          </ul>
        </div>
      </div>
    </div>
  </form>
</div>

<router-outlet />